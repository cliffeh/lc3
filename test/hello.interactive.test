#!/bin/bash
set -euxo pipefail

# tests that interactive mode correctly executes the program

# if unset we'll expect our input to reside in the directory alongside our script
DIR=$(dirname "$0")
SRCDIR=${SRCDIR:-$DIR/..}
BUILDDIR=${BUILDDIR:-$DIR/..}

CMDS="asm $SRCDIR/test/hello.asm\nrun"

# TODO this is admittedly a bit fragile
echo -e "$CMDS" | "$BUILDDIR/lc3vm" -i | tail -3 | diff "$SRCDIR/test/hello.interactive.expect" -
